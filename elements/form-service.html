<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="item-form.html">
<link rel="import" href="../mixins/toast-mixin.html">

<!-- FIREBASE SERVICE META -->
<link rel="import" href="../bower_components/iron-meta/iron-meta.html">
    
<dom-module id="form-service">
  <!-- Optional shadow DOM template -->
  <template>
    <style>
      /* CSS rules for your element */
    </style>

    <iron-meta id="elmeta"></iron-meta>

    <item-form on-save-item="saveItem"></item-form>

   

  </template>

  <script>

    // Define the element's API using an ES2015 class
    class FormService extends ToastMixin(Polymer.Element) {

      static get is() { return 'form-service'; }

      // Declare properties for the element's public API         
      static get properties() {
        return {

          /** Receive the firebase-service from iron-meta to access all the Firebase services .*/
          fireService:Object,

          /** Object that contents fbapp object included in the fbapp property of firebaService Object .*/
          fbapp:Object,

          item:{
            type:Object,
       
          },
       
        }
      }

      ready(){
        super.ready();

        /** firebase service Objects */
        this.fireService = this.$.elmeta.byKey('shareService');
        this.fbapp = this.fireService.fbapp;
      }

      saveItem(e){
        this.item = e.detail;
        let db = this.fbapp.firestore();
        let itemRef = db.collection(this.item.name).doc(); //item path to save the item id to use it later
        this.item.Id = itemRef.id; // save the item id to use it later
        itemRef.set(this.item) // save item in Firebase Firestore
            .then(()=>{
              this.launchPositiveToast('Item cadastrado')           
            })
            .catch(function(error){
              console.log(error);
              this.launchNegativeToast('Opps! Error')
            });
      }
     

    }

    // Register the x-custom element with the browser
    customElements.define(FormService.is, FormService);
  </script>

</dom-module>