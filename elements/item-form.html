<link rel="import" href="../bower_components/polymer/polymer-element.html">

<!-- VAADIN COMBO BOX -->
<link rel="import" href="../bower_components/vaadin-valo-theme/vaadin-combo-box.html">
<link rel="import" href="../bower_components/vaadin-combo-box/vaadin-combo-box.html">
<!-- VAADIN TEXT FIELD -->
<link rel="import" href="../bower_components/vaadin-text-field/vaadin-text-field.html">

<!-- FIREBASE SERVICE META -->
<link rel="import" href="../bower_components/iron-meta/iron-meta.html">

<!-- MIXINS -->
<link rel="import" href="../mixins/add-firecollection-combobox.html">


    
<dom-module id="item-form">
  <!-- Optional shadow DOM template -->
  <template>
    <style>
      
    	vaadin-combo-box, vaadin-text-field{
      		width: 15rem;  
     	}

    </style>

    <iron-meta id="elmeta"></iron-meta>

	<!-- COMBOS -->
    <div class="combo-container">
      	<vaadin-combo-box 
      		id="comboMarkets" 
      		label="Supermercado" 
      		placeholder="Seleciona" 
      		items="[[supermarket]]" 
      		on-selected-item-changed="enableComboProd" 
      		required 
      		error-message="seleciona um supermercado">
      	</vaadin-combo-box>
    </div>

    <div class="combo-container">
     	<vaadin-combo-box 
     		id="comboProducts" 
     		label="Produto" 
     		placeholder="Seleciona" 
     		items="[[products]]"  
     		on-selected-item-changed="enableComboBrand" 
     		required 
     		error-message="seleciona um producto" 
     		disabled>         
      	</vaadin-combo-box>
    </div>

    <div class="combo-container">
    	<vaadin-combo-box 
    		id="comboBrands" 
    		label="Marca" 
    		placeholder="Seleciona" 
    		items="[[brands]]" 
    		on-selected-item-changed="enableField" 
    		disabled>
       	</vaadin-combo-box>
    </div>

	<!-- INPUT FIELD -->
    <div class="text-field-container">
    	<vaadin-text-field 
    		label="Preço" 
    		id="priceField" 
    		required 
    		pattern="^(([0-9]+(?:\.[0-9]+)?)|([0-9]*(?:\.[0-9]+)?))$" 
    		error-message="incluir um número válido (.)" 
    		placeholder="Digita" 
    		disabled>
    	</vaadin-text-field>
    </div>

  </template>

  <script>

    // Define the element's API using an ES2015 class
    class ItemForm extends AddFirecollectionCombobox(Polymer.Element) {

      static get is() { return 'item-form'; }

      // Declare properties for the element's public API         
      static get properties() {
        return {

          supermarket:{
            type:Array,
            value(){
              return ['carrefour','dia','epa','supernosso','verdemar']
            }
          },

          /** Receive the firebase-service from iron-meta to access all the Firebase services .*/
          fireService:Object,

          /** Object that contents fbapp object included in the fbapp property of firebaService Object .*/
          fbapp:Object,

          /** Products Array where store product names receceived by Firebase Firestore (add-firecollection-combobox Mixin) .*/
          products:{
            type:Array,
            value(){
              return[]
            }
          },
          /** Products Array where store product brands receceived by Firebase Firestore (add-firecollection-combobox Mixin)  .*/
          brands:{
            type:Array,
            value(){
              return[]
            }
          },

        }
      }

      ready(){
      	super.ready();

      	this.set('products',[]); // clean Array in order not to duplicate

      	/** firebase service Objects */
      	this.fireService = this.$.elmeta.byKey('shareService');
      	this.fbapp = this.fireService.fbapp;
		let db = this.fbapp.firestore();

		/** add-firecollection-combobox Mixin */
      	this.addList('products','products',db); 
      	this.addList('brands','brands',db); 
      }

      /** enable comboProducts vaadin-combo-box when supermarket is selected in comboMarkets vaadin-combo-box. */
      enableComboProd(){
        this.$.comboProducts.disabled = false;
      }

      enableComboBrand(){  
        this.$.comboBrands.disabled = false;
      }
      
      enableField(){  
        this.$.priceField.disabled = false;
      }

    }

    // Register the x-custom element with the browser
    customElements.define(ItemForm.is, ItemForm);
  </script>

</dom-module>